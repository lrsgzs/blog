<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>刘镕硕的博客 - 文章</title>
        <script>
var sm;
var json;
function GetRequest() {
    const url = location.search;
    let theRequest = new Object();
    if (url.indexOf("?") != -1) {
        let str = url.substr(1);
        strs = str.split("&");
        for(let i = 0; i < strs.length; i ++) {
           theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);
        }
    }
   return theRequest;
}
var haha = function(data){
    console.log(data);
    json = data;
    sm = json["data"].length
}
        </script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <script src="https://api.github.com/repos/lrsgzs/blog_topics/contents/topics?callback=haha"></script>

    </head>
    <body>
        <span>刘镕硕的博客</span> | <span><a href="/">主页</a></span> | <span><a href="/topic/index.html">文章</a></span>
        <hr width="100%" align="left">
        <div id="main"></div>
        <script>
function getDecode(str){
    return decodeURIComponent(atob(str).split('').map(function (c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
}
var showwz = function(data){
    document.getElementById('main').innerHTML = marked.parse(getDecode(data["data"]["content"]).replaceAll("\r", "")); 
}
let ages = GetRequest();
var content = document.getElementById("main");
try{
    let id = ages["id"]
    var idi = parseInt(id)
    if (isNaN(idi)){
        var innetext = "<p>一共有" + String(sm) + "篇文章</p>";
        for (var i=0; i < sm; i++){
            innetext = innetext + '<a href="/topic.html?id=' + String(i + 1) + '">第' + String(i+1) + '篇文章：</a>'
        }
        content.innerHTML = innetext
    }else{
        if (idi <= sm){
            url = json["data"][idi - 1]["_links"]["self"] + "&callback=showwz"
            var script_dom = document.createElement('script');
            script_dom.src = url;
            script_dom.language = 'javascript';
            script_dom.type = 'text/javascript';
            var head = document.getElementsByTagName('head').item(0);//这个是往本页面动态加载js脚本
            head.appendChild(script_dom);
            console.log(url)
        }else{
            content.innerHTML = "<h1>404</h1>"
        }
    }
}catch(err){
    console.log(err)
    content.innerHTML = "<h1>Hello!</h1>"
}


// document.getElementById('content').innerHTML =
// marked.parse('# Marked in the browser\n\nRendered by **marked**.');
        </script>
    </body>
</html>